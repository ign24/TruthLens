import{g as O,r as c,l as G,s as J,z as Q,k as S,c as i,o as u,h as k,e as X,a as e,w as Z,j as T,x as K,F as E,i as N,f as ee,t as te,C as ae,p as se,v as oe,y as ne,D as f}from"./index-yMFJ6_hg.js";const B="development",le="http://localhost:8000",F=le,$={CHAT:"/api/v1/chat",ANALYZE:"/api/v1/analyze",HEALTH:"/api/v1/health"},P=o=>`${F}${$[o]}`,_=async()=>!0;console.log("API Configuration:",{environment:B,baseUrl:F,endpoints:$,isLocal:B==="development",frontendPort:8e3,backendPort:5e3});const re={key:0,class:"flex-none w-full h-16 border-b border-white/10 bg-slate-800/95 flex items-center py-2 rounded-t-2xl shadow-md"},ie=["role"],ue=["innerHTML"],ce=["innerHTML"],de={key:0,class:"flex justify-center items-center space-x-2 bg-gradient-to-b from-slate-800/80 to-slate-900/80 border border-white/5 rounded-2xl p-2 shadow-inner min-w-[3.5rem] max-w-[5rem] w-fit self-start"},me={key:1,class:"w-full flex gap-2 justify-center items-center px-4 pb-2 mt-2"},pe=["onClick"],fe={class:"flex-none w-full px-4 py-3 bg-gradient-to-r from-slate-800/95 to-slate-700/95 border-t border-white/10 flex items-center rounded-b-none md:rounded-b-2xl shadow-lg"},he=["disabled"],ve={class:"flex gap-2"},ge=["disabled"],be=["disabled"],H=3,ye={__name:"ChatBot",props:{articleText:{type:String,required:!0},analysisResult:{type:Object,required:!1,default:null,validator:o=>o?["factual_accuracy","bias","emotional_tone","recommendation"].every(j=>j in o):!0},standalone:{type:Boolean,default:!1}},emits:["close"],setup(o,{emit:j}){const d=o,I=j,m=c(!1),n=c([]),l=c(""),h=c(!1),b=c(!1),A=c(null),y=c(null),R=c(!1),g=c(!0),w=c(0),V=[{label:"Analyze for bias",value:"Analyze this news article for bias"},{label:"Source credibility",value:"Evaluate source credibility"},{label:"Detect emotional manipulation",value:"Detect emotional manipulation"}],C=()=>{R.value=window.innerWidth<=768};G(async()=>{C(),window.addEventListener("resize",C),g.value=await _(),g.value||n.value.push({role:"assistant",content:"We're having trouble connecting to our servers. Please try again in a moment."})}),J(()=>{window.removeEventListener("resize",C)}),Q(()=>({"translate-y-0 opacity-100 scale-100 rotate-0":m.value,"translate-y-full opacity-0 scale-95 rotate-1 pointer-events-none":!m.value}));const z=()=>{m.value=!m.value,m.value?f(()=>{v(),R.value&&(document.body.style.overflow="hidden")}):(I("close"),document.body.style.overflow="")},x=()=>{A.value&&f(()=>{A.value.scrollTop=A.value.scrollHeight})},v=()=>{if(y.value){y.value.focus();const t=y.value.value.length;y.value.setSelectionRange(t,t)}},M=async()=>{if(l.value.trim())try{if(!g.value){if(g.value=await _(),!g.value){if(w.value<H)return w.value++,n.value.push({role:"assistant",content:`Warning: Retrying server connection (attempt ${w.value}/${H})...`}),await new Promise(L=>setTimeout(L,2e3)),M();throw w.value=0,new Error("Unable to connect to the server after several attempts. Please verify that the server is running.")}w.value=0}h.value=!0,b.value=!0;const t={role:"user",content:l.value};n.value.push(t);const a=l.value;l.value="",x();const s={role:"system",content:`You are the TruthLens Assistant, the expert and friendly guide for the TruthLens platform. Your job is to help users analyze news articles, understand the results, and use the platform effectively to detect misinformation, bias, and emotional manipulation.

Tu rol es ayudar a los usuarios a entender cómo funciona TruthLens y cómo interpretar los resultados del análisis de noticias. Siempre debes responder en el mismo idioma que el usuario (inglés o español).

Your core roles / Tus funciones principales:

1. Platform Guide / Guía de plataforma:
   - Explain how to use the platform: paste an article, press "Analyze", and view the metrics.
   - Explica cómo usar la plataforma: pegar un artículo, presionar "Analizar" y ver las métricas.
   - Walk users through each section: Fake News %, Political Bias, Emotional Language, Article Style, Reader Recommendation.
   - Explica cada sección: Porcentaje de Fake News, Sesgo Político, Lenguaje Emocional, Estilo del Artículo, Recomendación.

2. NLP Techniques Used / Técnicas utilizadas:
   TruthLens uses NLP and large language models to analyze news. It applies:
   - Fake News Detection: factual consistency and speculative language.
   - Detección de Fake News: consistencia factual y lenguaje especulativo.
   - Political Bias: lexical patterns and ideological framing.
   - Sesgo Político: patrones léxicos y encuadre ideológico.
   - Emotional Tone: emotion classification (fear, joy, anger...).
   - Tono Emocional: clasificación emocional (miedo, alegría, enojo...).
   - Article Style: objective, subjective, speculative, emotive, clickbait.
   - Estilo: objetivo, subjetivo, especulativo, emotivo, clickbait.
   - Reader Recommendation: a summary to help users decide what to trust.
   - Recomendación: una síntesis para decidir si confiar o no.

3. Explanation / Explicación:
   - Help users interpret results with examples.
   - Ayuda a interpretar resultados con ejemplos.
   - Warn about manipulative language or lack of sources.
   - Advierte sobre lenguaje manipulado o falta de fuentes.

4. Critical Thinking / Pensamiento Crítico:
   - Encourage verifying claims with external sources.
   - Fomentar la verificación con fuentes externas.
   - Remind users that AI analysis is a tool, not a final verdict.
   - Recordar que este análisis es una guía, no una verdad absoluta.

5. Tone / Tono:
   - Be clear, concise, helpful and neutral.
   - Sé claro, conciso, útil y neutral.
   - Structure answers with bullets or short paragraphs when helpful.
   - Estructura tus respuestas con viñetas o párrafos cortos si ayuda.

Always identify yourself as the TruthLens Assistant. / Siempre identifícate como el Asistente de TruthLens.`};console.log("Sending message to:",P("CHAT")),console.log("Request payload:",{messages:[s,...n.value],article_text:d.articleText||void 0,analysis_result:d.analysisResult||void 0});const r=await fetch(P("CHAT"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[s,...n.value],article_text:d.articleText||void 0,analysis_result:d.analysisResult||void 0})});if(!r.ok){const L=await r.json().catch(()=>null);throw console.error("Server response:",{status:r.status,statusText:r.statusText,errorData:L}),r.status===404?new Error("Chat endpoint is not available. Please verify server configuration."):r.status===503?(g.value=!1,new Error("Server is temporarily unavailable. Please try again later.")):new Error(`Error communicating with server: ${r.status} ${r.statusText}`)}const p=await r.json();console.log("Server response:",p),n.value.push({role:"assistant",content:p.response||p.message&&p.message.content||"Error: No response from backend"}),x(),f(()=>{v()})}catch(t){console.error("Error details:",t),n.value.push({role:"assistant",content:`Sorry, there was an error processing your message: ${t.message}. Please try again.`}),f(()=>{v()})}finally{h.value=!1,b.value=!1}},q=async()=>{if(l.value.trim())try{h.value=!0,b.value=!0;const t={role:"user",content:l.value};n.value.push(t);const a=l.value;l.value="",x();const s={role:"system",content:`You are the TruthLens Assistant, the expert and friendly guide for the TruthLens platform. Your job is to help users analyze news articles, understand the results, and use the platform effectively to detect misinformation, bias, and emotional manipulation.

Tu rol es ayudar a los usuarios a entender cómo funciona TruthLens y cómo interpretar los resultados del análisis de noticias. Siempre debes responder en el mismo idioma que el usuario (inglés o español).

Your core roles / Tus funciones principales:

1. Platform Guide / Guía de plataforma:
   - Explain how to use the platform: paste an article, press "Analyze", and view the metrics.
   - Explica cómo usar la plataforma: pegar un artículo, presionar "Analizar" y ver las métricas.
   - Walk users through each section: Fake News %, Political Bias, Emotional Language, Article Style, Reader Recommendation.
   - Explica cada sección: Porcentaje de Fake News, Sesgo Político, Lenguaje Emocional, Estilo del Artículo, Recomendación.

2. NLP Techniques Used / Técnicas utilizadas:
   TruthLens uses NLP and large language models to analyze news. It applies:
   - Fake News Detection: factual consistency and speculative language.
   - Detección de Fake News: consistencia factual y lenguaje especulativo.
   - Political Bias: lexical patterns and ideological framing.
   - Sesgo Político: patrones léxicos y encuadre ideológico.
   - Emotional Tone: emotion classification (fear, joy, anger...).
   - Tono Emocional: clasificación emocional (miedo, alegría, enojo...).
   - Article Style: objective, subjective, speculative, emotive, clickbait.
   - Estilo: objetivo, subjetivo, especulativo, emotivo, clickbait.
   - Reader Recommendation: a summary to help users decide what to trust.
   - Recomendación: una síntesis para decidir si confiar o no.

3. Explanation / Explicación:
   - Help users interpret results with examples.
   - Ayuda a interpretar resultados con ejemplos.
   - Warn about manipulative language or lack of sources.
   - Advierte sobre lenguaje manipulado o falta de fuentes.

4. Critical Thinking / Pensamiento Crítico:
   - Encourage verifying claims with external sources.
   - Fomentar la verificación con fuentes externas.
   - Remind users that AI analysis is a tool, not a final verdict.
   - Recordar que este análisis es una guía, no una verdad absoluta.

5. Tone / Tono:
   - Be clear, concise, helpful and neutral.
   - Sé claro, conciso, útil y neutral.
   - Structure answers with bullets or short paragraphs when helpful.
   - Estructura tus respuestas con viñetas o párrafos cortos si ayuda.

Always identify yourself as the TruthLens Assistant. / Siempre identifícate como el Asistente de TruthLens.`},p=await(await fetch(P("CHAT"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[s,...n.value],article_text:d.articleText||void 0,analysis_result:d.analysisResult||void 0,use_web_search:!0})})).json();n.value.push({role:"assistant",content:p.response||p.message&&p.message.content||"Error: No response from backend"}),x(),f(()=>v())}catch(t){n.value.push({role:"assistant",content:`Sorry, there was an error processing your message: ${t.message}. Please try again.`}),f(()=>v())}finally{h.value=!1,b.value=!1}};function D(t){l.value=t.value,f(()=>{v()})}S(()=>d.articleText,t=>{console.log("📄 Artículo actualizado:",t?"Presente":"Ausente")},{immediate:!0}),S(()=>d.analysisResult,t=>{console.log("📊 Análisis actualizado:",t?"Presente":"Ausente")},{immediate:!0}),S(n,()=>{f(()=>{x()})},{deep:!0});const U=t=>{t.style.transform="translateY(20px) scale(0.98)",t.style.opacity="0",t.style.filter="blur(4px)",requestAnimationFrame(()=>{t.style.transition="all 800ms cubic-bezier(0.16, 1, 0.3, 1)",t.style.transform="translateY(0) scale(1)",t.style.opacity="1",t.style.filter="blur(0px)"})},Y=(t,a)=>{t.style.transition="all 600ms cubic-bezier(0.16, 1, 0.3, 1)",t.style.transform="translateY(20px) scale(0.98)",t.style.opacity="0",t.style.filter="blur(4px)",t.addEventListener("transitionend",a,{once:!0})};function W(t){return t.replace(/(https?:\/\/[^\s)]+)/g,'<a href="$1" target="_blank" rel="noopener noreferrer" class="underline text-blue-300 hover:text-blue-400 break-all">$1</a>')}return(t,a)=>(u(),i("div",{class:T([o.standalone?"w-full h-full":m.value?"fixed bottom-4 z-30":"fixed bottom-4 right-4 z-5"])},[!o.standalone&&!m.value?(u(),i("button",{key:0,onClick:z,class:"bg-gradient-to-r from-cyan-400 to-blue-500 text-white rounded-full p-3 md:p-4 shadow-lg transition-all duration-300 hover:opacity-90 hover:scale-105 active:scale-95 chat-button touch-manipulation","aria-label":"Abrir chat",style:{position:"absolute",bottom:"0",right:"0",margin:"0 0 0 0"}},a[1]||(a[1]=[e("div",{class:"chat-button-glow"},null,-1),e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 md:h-7 md:w-7 chat-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})],-1)]))):k("",!0),X(ne,{name:"chat",onEnter:U,onLeave:Y},{default:Z(()=>[o.standalone||m.value?(u(),i("div",{key:0,class:T([o.standalone?"w-full h-full bg-transparent border-none shadow-none rounded-none flex flex-col":"w-full h-full md:w-[450px] md:h-[600px] md:bottom-8 md:right-8 md:fixed bg-slate-900/80 backdrop-blur-md rounded-none md:rounded-2xl shadow-2xl border border-white/10 flex flex-col"]),role:"dialog","aria-modal":"true","aria-label":"Chat de TruthLens",style:{"margin-top":"2rem"}},[o.standalone?k("",!0):(u(),i("div",re,[e("div",{class:"flex items-center justify-between w-full px-6"},[a[3]||(a[3]=e("div",{class:"flex items-center space-x-1"},[e("h3",{class:"text-white text-base font-display font-semibold bg-gradient-to-r from-cyan-300 to-blue-400 bg-clip-text text-transparent header-inset-title"},"TruthLens Assistant")],-1)),e("button",{onClick:z,class:"close-btn-inset text-blue-200/80 hover:text-white transition-colors p-2 rounded-lg touch-manipulation","aria-label":"Cerrar chat"},a[2]||(a[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"close-svg-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])),e("div",{ref_key:"messagesContainer",ref:A,class:T(["flex-1 overflow-y-auto space-y-3 scroll-smooth",o.standalone?"min-h-[420px] md:min-h-[500px] bg-slate-900/95 rounded-2xl p-6 md:p-8":"px-6 py-6 bg-slate-900/95"]),role:"log","aria-live":"polite"},[(u(!0),i(E,null,N(n.value,(s,r)=>(u(),i("div",{key:r,class:T(["flex w-full",s.role==="user"?"justify-end":"justify-start"])},[e("div",{class:T([{"bg-gradient-to-b from-blue-600/10 to-blue-700/10 border border-blue-500/10 shadow-inner user-bubble":s.role==="user","bg-gradient-to-b from-slate-800/80 to-slate-900/80 border border-white/5 shadow-inner assistant-bubble":s.role==="assistant","bg-gradient-to-b from-red-900/20 to-red-800/20 border border-red-500/10 shadow-inner":s.role==="assistant"&&s.content.includes("Error")},"max-w-[85%] md:max-w-[80%] rounded-2xl p-4 text-white animate-fade-in text-sm leading-relaxed flex items-center"]),role:s.role==="user"?"status":"alert"},[s.role==="assistant"?(u(),i(E,{key:0},[a[4]||(a[4]=e("span",{class:"mr-2","aria-label":"Asistente"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"msg-svg-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("rect",{x:"4",y:"8",width:"16",height:"10",rx:"4","stroke-width":"2",stroke:"currentColor",fill:"none"}),e("circle",{cx:"9",cy:"13",r:"1",fill:"currentColor"}),e("circle",{cx:"15",cy:"13",r:"1",fill:"currentColor"}),e("path",{"stroke-linecap":"round","stroke-width":"2",stroke:"currentColor",d:"M12 8V4m-6 4V6m12 2V6"})])],-1)),e("div",{class:"whitespace-pre-wrap",innerHTML:W(s.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"))},null,8,ue)],64)):(u(),i(E,{key:1},[e("div",{class:"whitespace-pre-wrap",innerHTML:s.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>")},null,8,ce),a[5]||(a[5]=e("span",{class:"ml-2","aria-label":"Usuario"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"msg-svg-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14c-4.418 0-8 1.79-8 4v2h16v-2c0-2.21-3.582-4-8-4z"})])],-1))],64))],10,ie)],2))),128)),b.value?(u(),i("div",de,a[6]||(a[6]=[e("div",{class:"w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce"},null,-1),e("div",{class:"w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce delay-100"},null,-1),e("div",{class:"w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce delay-200"},null,-1)]))):k("",!0),K(t.$slots,"default",{},void 0,!0)],2),o.standalone?(u(),i("div",me,[(u(),i(E,null,N(V,s=>e("button",{key:s.label,onClick:r=>D(s),class:"flex items-center gap-2 px-3 py-3 rounded-lg border border-cyan-400/20 bg-slate-800/80 text-sm font-medium text-white shadow hover:bg-slate-800/95 hover:border-cyan-400/60 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-400 flex-1 min-w-0"},[a[7]||(a[7]=e("svg",{class:"w-4 h-4 text-cyan-300",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{d:"M12 3v6m0 6v6m9-9h-6m-6 0H3m13.07-6.93l-4.24 4.24m0 0l-4.24-4.24m8.48 8.48l-4.24 4.24m0 0l-4.24-4.24","stroke-linecap":"round"})],-1)),ee(" "+te(s.label),1)],8,pe)),64))])):k("",!0),e("div",fe,[e("form",{onSubmit:ae(M,["prevent"]),class:"flex w-full items-center gap-2"},[se(e("input",{ref_key:"inputRef",ref:y,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value=s),type:"text",placeholder:"Type your message or question here...",class:"flex-1 bg-slate-800/80 text-white rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-1 focus:ring-cyan-400/40 border border-cyan-400/15 placeholder-blue-200/60 transition-all duration-200 hover:border-cyan-400/25 h-12 shadow-sm chat-input",disabled:h.value,onFocus:v,"aria-label":"Message",autocomplete:"off"},null,40,he),[[oe,l.value]]),e("div",ve,[e("button",{type:"submit",disabled:h.value||!l.value.trim(),class:"btn-inset flex flex-col items-center justify-center","aria-label":"Send message",title:"Send"},a[8]||(a[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 20 20",stroke:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z","clip-rule":"evenodd"})],-1),e("span",{class:"text-xs mt-1 block md:hidden"},"Send",-1)]),8,ge),e("button",{type:"button",onClick:q,disabled:h.value||!l.value.trim(),class:"btn-inset flex flex-col items-center justify-center","aria-label":"Verify with sources",title:"Verify with sources from the web"},a[9]||(a[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),e("span",{class:"text-xs mt-1 block md:hidden"},"Verify",-1)]),8,be)])],32)])],2)):k("",!0)]),_:3})],2))}},xe=O(ye,[["__scopeId","data-v-d3685f6b"]]);export{xe as C,_ as c,P as g};
